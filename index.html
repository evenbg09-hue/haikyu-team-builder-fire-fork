<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>Haikyu Fly High - Team Builder (Rascunho)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#0f7f7f;
    --panel:#222;
    --card:#333;
    --accent:#fff;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: Inter, Arial, Helvetica, sans-serif;
    background: var(--bg);
    color:var(--accent);
  }

  /* fundo central (quadra) */
  .page {
    min-height:300vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:45px;
    padding:45px;
    box-sizing:border-box;
  }

  h1{
    margin:6px 0 0;
    text-shadow:0 2px 6px rgba(0,0,0,.5);
  }

  /* container da quadra (posições absolutas dentro) */
  .court-wrap{
    width:100%;
    max-width:1000px;
    aspect-ratio: 16/9;
    position:relative;
    background: center/cover no-repeat url("img/quadra.png");
    border-radius:10px;
    box-shadow:0 6px 18px rgba(0,0,0,.5);
    overflow:visible;
  }

  /* padrão dos slots (caixinha que conterá imagem + nome) */
  .slot {
    position:absolute;
    width:120px;
    height:150px;
    background: rgba(0,0,0,0.45);
    border:2px solid rgba(255,255,255,0.12);
    border-radius:8px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    gap:6px;
    padding:6px;
    box-sizing:border-box;
    cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease;
  }
  .slot:hover{ transform: translateY(-6px); box-shadow:0 10px 30px rgba(0,0,0,.6); }

  .slot .role{
    font-size:12px;
    font-weight:700;
    letter-spacing:.6px;
    align-self:flex-start;
    background:rgba(0,0,0,0.55);
    padding:3px 6px;
    border-radius:4px;
  }

  .slot .portrait{
    width:100%;
    height:88px;
    background:linear-gradient(180deg,#222,#111);
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
    border-radius:6px;
  }
  .slot .portrait img{
    max-width:100%;
    max-height:100%;
    display:block;
  }

  .slot .name{
    width:100%;
    font-size:13px;
    text-align:center;
    margin-top:4px;
    word-break:break-word;
    line-height:1.05;
    min-height:34px; /* garante espaço para nomes maiores */
  }

  /* bench (banco): os quatro slots adicionais */
  .bench {
    position:absolute;
    display:flex;
    gap:12px;
    left:45%;
    transform:translateX(-50%);
    bottom:6%;
    z-index:8;
  }
  .bench .slot{ width:90px; height:118px; padding:6px; }

  /* Painel de seleção (scroll horizontal) - aparece quando clicar em um slot */
  .picker {
    position:relative;
    width:100%;
    max-width:1000px;
    margin:8px 0 0;
  }
  .picker-inner{
    display:flex;
    gap:8px;
    align-items:center;
    padding:10px;
    background:var(--card);
    border-radius:10px;
    overflow-x:auto;
    box-shadow:0 6px 18px rgba(0,0,0,.45);
  }
  .picker-card{
    flex:0 0 auto;
    width:78px;
    text-align:center;
    padding:6px;
    border-radius:8px;
    background:rgba(0,0,0,0.35);
    cursor:grab;
    user-select:none;
  }
  .picker-card img{
    width:100%;
    height:64px;
    object-fit:cover;
    border-radius:6px;
    display:block;
  }
  .picker-card .pname{
    font-size:11px;
    margin-top:6px;
    line-height:1.0;
  }

  /* painel de sinergias */
  #synergy-panel{
    width:100%;
    max-width:900px;
    background:var(--panel);
    padding:10px 14px;
    border-radius:10px;
    box-shadow:0 6px 18px rgba(0,0,0,.45);
    color:#e9e9e9;
  }
  #synergy-panel h2{ margin:0 0 6px; font-size:16px; }
  #synergy-list{ margin:0; padding-left:18px; }

  /* responsivo */
  @media (max-width:720px){
    .slot{ width:92px; height:120px; }
    .slot .name{ min-height:28px; font-size:12px; }
    .bench{ left:50%; bottom:4%; gap:8px; }
    .picker-card{ width:64px; }
  }
</style>
</head>
<body>
  <div class="page">
    <h1>Team Builder — Rascunho</h1>

    <!-- quadra com posições absolutas -->
    <div class="court-wrap" id="court">

      <!-- linha de frente (frente da rede) - 3 posições -->
      <div class="slot" id="slot-front-left" data-role="Wing Spiker" style="top:16%; left:20%;">
        <div class="role">WS</div>
        <div class="portrait"></div>
        <div class="name">Nome</div>
      </div>

      <div class="slot" id="slot-front-center" data-role="Middle Blocker" style="top:14%; left:42%;">
        <div class="role">MB</div>
        <div class="portrait"></div>
        <div class="name">Nome</div>
      </div>

      <div class="slot" id="slot-front-right" data-role="Opposite" style="top:16%; left:64%;">
        <div class="role">OP</div>
        <div class="portrait"></div>
        <div class="name">Nome</div>
      </div>

      <!-- linha de trás (defesa) - 3 posições -->
      <div class="slot" id="slot-back-left" data-role="Wing Spiker" style="top:44%; left:24%;">
        <div class="role">WS</div>
        <div class="portrait"></div>
        <div class="name">Nome</div>
      </div>

      <div class="slot" id="slot-back-center" data-role="Setter" style="top:48%; left:44%;">
        <div class="role">S</div>
        <div class="portrait"></div>
        <div class="name">Nome</div>
      </div>

      <div class="slot" id="slot-back-right" data-role="Middle Blocker" style="top:44%; left:64%;">
        <div class="role">MB</div>
        <div class="portrait"></div>
        <div class="name">Nome</div>
      </div>

      <!-- líbero -->
      <div class="slot" id="slot-libero" data-role="Libero" style="top:62%; left:44%;">
        <div class="role">L</div>
        <div class="portrait"></div>
        <div class="name">Nome</div>
      </div>

      <!-- banco: 4 slots alinhados próximos ao banco -->
      <div class="bench" id="bench">
        <div class="slot bench-slot" id="bench-1" data-role="Any">
          <div class="role">Banco</div>
          <div class="portrait"></div>
          <div class="name">Vago</div>
        </div>
        <div class="slot bench-slot" id="bench-2" data-role="Any">
          <div class="role">Banco</div>
          <div class="portrait"></div>
          <div class="name">Vago</div>
        </div>
        <div class="slot bench-slot" id="bench-3" data-role="Any">
          <div class="role">Banco</div>
          <div class="portrait"></div>
          <div class="name">Vago</div>
        </div>
        <div class="slot bench-slot" id="bench-4" data-role="Any">
          <div class="role">Banco</div>
          <div class="portrait"></div>
          <div class="name">Vago</div>
        </div>
      </div>

    </div> <!-- court-wrap -->

    <!-- painel com scroller de personagens (esconde/mostra conforme slot clicado) -->
    <div class="picker" id="picker" aria-hidden="true" style="display:none;">
      <div class="picker-inner" id="pickerInner"></div>
    </div>

    <!-- sinergias -->
    <div id="synergy-panel">
      <h2>Sinergias Ativas</h2>
      <ul id="synergy-list"><li>Nenhuma sinergia ativa</li></ul>
    </div>
  </div>

<script>
/* ====== Dados dos personagens (caminhos esperam pasta img/ no repositório) ======
   Substitua as imagens na pasta img/ pelos arquivos recortados com os mesmos nomes.
*/
const personagens = [
  { nome:"Tobio Kageyama", funcao:"Setter", img:"img/kageyama.png", escola:"Karasuno", vinculo:"Freak Quick" },
  { nome:"Kōshi Sugawara", funcao:"Setter", img:"img/sugawara.png", escola:"Karasuno", vinculo:"Suporte" },
  { nome:"Kenma Kozume", funcao:"Setter", img:"img/kenma.png", escola:"Nekoma", vinculo:"Time Nekoma" },
  { nome:"Toru Oikawa", funcao:"Setter", img:"img/oikawa.png", escola:"Aoba Johsai", vinculo:"Parceria Iwaizumi" },
  { nome:"Shoyo Hinata", funcao:"Middle Blocker", img:"img/hinata.png", escola:"Karasuno", vinculo:"Freak Quick" },
  { nome:"Tetsurō Kuroo", funcao:"Middle Blocker", img:"img/kuroo.png", escola:"Nekoma", vinculo:"Time Nekoma" },
  { nome:"Kei Tsukishima", funcao:"Middle Blocker", img:"img/tsukishima.png", escola:"Karasuno", vinculo:"Dupla Yamaguchi" },
  { nome:"Takanobu Aone", funcao:"Middle Blocker", img:"img/aone.png", escola:"Date Tech", vinculo:"Paredão de Ferro" },
  { nome:"Wakatoshi Ushijima", funcao:"Wing Spiker", img:"img/ushijima.png", escola:"Shiratorizawa", vinculo:"Capitão" },
  { nome:"Hajime Iwaizumi", funcao:"Wing Spiker", img:"img/iwaizumi.png", escola:"Aoba Johsai", vinculo:"Parceria Oikawa" },
  { nome:"Ryūnosuke Tanaka", funcao:"Wing Spiker", img:"img/tanaka.png", escola:"Karasuno", vinculo:"Dupla Nishinoya" },
  { nome:"Kentarō Kyōtani", funcao:"Opposite", img:"img/kyotani.png", escola:"Aoba Johsai", vinculo:"Time Aoba Johsai" },
  { nome:"Asahi Azumane", funcao:"Wing Spiker", img:"img/asahi.png", escola:"Karasuno", vinculo:"Time Karasuno" },
  { nome:"Daichi Sawamura", funcao:"Opposite", img:"img/daichi.png", escola:"Karasuno", vinculo:"Capitão" },
  { nome:"Yū Nishinoya", funcao:"Libero", img:"img/nishinoya.png", escola:"Karasuno", vinculo:"Dupla Tanaka" },
  { nome:"Tadashi Yamaguchi", funcao:"Middle Blocker", img:"img/yamaguchi.png", escola:"Karasuno", vinculo:"Dupla Tsukishima" },
  { nome:"Issei Matsukawa", funcao:"Middle Blocker", img:"img/matsukawa.png", escola:"Aoba Johsai", vinculo:"Time Aoba Johsai" }
];

/* ====== Lógica de interação ====== */
const picker = document.getElementById('picker');
const pickerInner = document.getElementById('pickerInner');
const synergyList = document.getElementById('synergy-list');

let selectedSlots = []; // lista de personagens atualmente alocados (objetos)
let activeSlot = null;  // slot DOM atualmente ativo (clicado)

function makePickerForRole(role){
  // role pode ser "Any" para o banco (mostra todos)
  pickerInner.innerHTML = '';
  const list = role === 'Any' ? personagens : personagens.filter(p => p.funcao === role);
  if(list.length === 0){
    const n = document.createElement('div');
    n.textContent = 'Nenhum personagem disponível';
    n.style.padding='8px';
    pickerInner.appendChild(n);
    return;
  }
  list.forEach(p => {
    const card = document.createElement('div');
    card.className = 'picker-card';
    card.draggable = true;

    const img = document.createElement('img');
    img.src = p.img;
    img.alt = p.nome;
    img.loading = 'lazy';

    const lbl = document.createElement('div');
    lbl.className = 'pname';
    lbl.textContent = p.nome;

    card.appendChild(img);
    card.appendChild(lbl);

    // clique rápido coloca no slot ativo
    card.addEventListener('click', (ev) => {
      ev.stopPropagation();
      if(!activeSlot) return;
      setSlotCharacter(activeSlot, p);
      hidePicker();
    });

    // drag start -> envia nome para o drop target
    card.addEventListener('dragstart', (ev) => {
      ev.dataTransfer.setData('text/plain', p.nome);
      // opcional: set drag image
      try{
        ev.dataTransfer.setDragImage(img, 30, 30);
      }catch(e){}
    });

    pickerInner.appendChild(card);
  });
}

/* coloca personagem visualmente no slot (slot é elemento .slot) */
function setSlotCharacter(slotEl, personagem){
  const portrait = slotEl.querySelector('.portrait');
  const nameEl = slotEl.querySelector('.name');

  // limpa e insere
  portrait.innerHTML = '';
  const img = document.createElement('img');
  img.src = personagem.img;
  img.alt = personagem.nome;
  portrait.appendChild(img);

  nameEl.textContent = personagem.nome;

  // registra na lista de selecionados (substitui caso já exista para o mesmo slot)
  // guardamos referência via attribute data-assigned
  slotEl.dataset.assigned = personagem.nome;
  updateSelectedList();
}

/* remove personagem do slot (duplo clique) */
function clearSlot(slotEl){
  const portrait = slotEl.querySelector('.portrait');
  const nameEl = slotEl.querySelector('.name');
  portrait.innerHTML = '';
  nameEl.textContent = slotEl.classList.contains('bench-slot') ? 'Vago' : 'Nome';
  delete slotEl.dataset.assigned;
  updateSelectedList();
}

/* construir selectedSlots a partir dos slots DOM que têm data-assigned */
function updateSelectedList(){
  selectedSlots = [];
  document.querySelectorAll('.slot').forEach(s => {
    if(s.dataset.assigned){
      const p = personagens.find(x => x.nome === s.dataset.assigned);
      if(p) selectedSlots.push(p);
    }
  });
  refreshSynergies();
}

/* monta painel de sinergias simples (escolas e vínculos presentes) */
function refreshSynergies(){
  synergyList.innerHTML = '';
  if(selectedSlots.length === 0){
    synergyList.innerHTML = '<li>Nenhuma sinergia ativa</li>';
    return;
  }
  const escolas = [...new Set(selectedSlots.map(p=>p.escola))];
  const vinculos = [...new Set(selectedSlots.map(p=>p.vinculo))];

  escolas.forEach(e => {
    const li = document.createElement('li');
    li.textContent = `Escola: ${e}`;
    synergyList.appendChild(li);
  });
  vinculos.forEach(v => {
    const li = document.createElement('li');
    li.textContent = `Vínculo: ${v}`;
    synergyList.appendChild(li);
  });
}

/* ====== attach events aos slots (click abre picker, drop aceita drag) ====== */
const allSlots = document.querySelectorAll('.slot');

allSlots.forEach(slot => {
  // abrir picker ao clicar
  slot.addEventListener('click', (ev) => {
    ev.stopPropagation();
    activeSlot = slot;
    const role = slot.dataset.role || 'Any';
    makePickerForRole(role);
    showPicker();
  });

  // aceitar drop
  slot.addEventListener('dragover', (ev) => {
    ev.preventDefault();
    slot.style.outline = '2px dashed rgba(255,255,255,0.25)';
  });
  slot.addEventListener('dragleave', (ev) => {
    slot.style.outline = '';
  });
  slot.addEventListener('drop', (ev) => {
    ev.preventDefault();
    slot.style.outline = '';
    const name = ev.dataTransfer.getData('text/plain');
    const p = personagens.find(x => x.nome === name);
    if(p){
      // se slot tem role restrito e personagem não bate -> permite apenas se role === Any OR mesmo funcao
      const role = slot.dataset.role || 'Any';
      if(role !== 'Any' && role !== p.funcao){
        // permitir trocar apenas se usuário confirmar
        const ok = confirm(`${p.nome} não é da função ${role}. Deseja colocar mesmo assim?`);
        if(!ok) return;
      }
      setSlotCharacter(slot, p);
    }
  });

  // duplo clique para remover
  slot.addEventListener('dblclick', (ev) => {
    ev.stopPropagation();
    clearSlot(slot);
  });
});

/* esconder picker ao clicar fora */
document.body.addEventListener('click', (ev) => {
  // se clicou em algum slot já tratado, picker mostra; caso contrário, esconde
  if(!ev.target.closest('.slot') && !ev.target.closest('.picker')){
    hidePicker();
    activeSlot = null;
  }
});

/* mostrar / esconder picker */
function showPicker(){
  picker.style.display = 'block';
  picker.setAttribute('aria-hidden','false');
  // rola para o início da lista
  pickerInner.scrollLeft = 0;
}
function hidePicker(){
  picker.style.display = 'none';
  picker.setAttribute('aria-hidden','true');
  pickerInner.innerHTML = '';
}

/* permitir arrastar do bench para slot e vice-versa via interação já implementada */

/* botão de teclado: ESC fecha picker */
document.addEventListener('keydown', (ev)=>{
  if(ev.key === 'Escape') { hidePicker(); activeSlot=null; }
});

/* inicialização: caso queira preencher com exemplos, descomente/set aqui */
// setSlotCharacter(document.getElementById('slot-back-center'), personagens.find(p=>p.funcao==='Setter'));

</script>
</body>
</html>

